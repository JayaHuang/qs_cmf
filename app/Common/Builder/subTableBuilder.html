<table id="{$table_id}" class="table">
    <tr>
        <volist name="table_header" id="header">
            <th <notempty name="header.width">width="{$header.width}"</notempty>>{$header.name}</th>
        </volist>
        <th>操作</th>
    </tr>
    <tr id="{$table_id}_add-panel">
        <td colspan="{:count($table_header)+1}" class="text-right">
            <span class="pull-left tip text-danger"></span>
            <button type="button" class="btn btn-sm btn-default " id="{$table_id}_addField">添加新字段</button>
        </td>
    </tr>
</table>

<script type="text/javascript" src="__PUBLIC__/libs/bootstrap-validator/validator.js"></script>
<script type="text/javascript" src="__PUBLIC__/libs/bootstrap-validator/bootstrap-validator.js"></script>
<script id="{$table_id}_field" type="text/template">
    <tr>

        <volist name="items" id="item">
            <td>
            <switch name="item.type">
                <case value='text'>
                    <input type="text" name="{$item.name}[]" class="form-control input-sm" value=""/>
                </case>
                <case value="select">
                    <select name="{$item.name}[]" class="form-control input-sm">
                        <option value="">----请选择----</option>
                        <volist name="item.options" id="option">
                            <option value="{$key}">{$option}</option>
                        </volist>
                    </select>
                </case>
                <case value="textarea">
                    <div class="input-control">
                        <textarea name="{$item.name}[]" class="form-control"></textarea>
                    </div>
                </case>
                <default />
            </switch>
            </td>
        </volist>

        <td>
            <button type="button" class="btn btn-danger btn-sm" onclick="$(this).parents('tr').remove();">删除</button>
        </td>
    </tr>
</script>
<script type="text/javascript">
    function render_data{$table_id}(data){
        var template = $($('#{$table_id}_field').clone().html());
        for(var i=0;i<data.length;i++){
            switch(data[i].type){
                case 'text':
                    template.find('input[name="' + data[i].name + '[]"]').val(data[i].value);
                    break;
                case 'select':
                case 'textarea':
                    template.find(data[i].type + '[name="' + data[i].name + '[]"]').val(data[i].value);
                    break;
            }
        }

        return template;
    }

    function addTableItem{$table_id}(data){
        if(!data){
            $($('#{$table_id}_field').clone().html()).insertBefore('#{$table_id}_add-panel');
        }
        else{
            var o = render_data{$table_id}(data);
            o.insertBefore('#{$table_id}_add-panel');
        }
    }

    jQuery(document).ready(function($){
        $('input,select,textarea').bs_validator();
        $('#{$table_id}_addField').click(function(){
            addTableItem{$table_id}();
        });
        <empty name="data">
            addTableItem{$table_id}();
        <else />
            <volist name="data" id="item">

            addTableItem{$table_id}(eval('{:json_encode($item)}'));
            </volist>

        </empty>


    });
</script>